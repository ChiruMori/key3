$(document).ready(function(){let datatable=null;let clubAssetsDiv=$("#clubAssets");const a=$("#hintArea");const d=function(e){return function(f){e(f);console.error(f);a.text("操作失败："+f.responseJSON.msg);a.addClass("text-danger")}};const b=function(e){clubAssetsDiv.text(e)};const c=function(e){if(datatable===null){datatable=$("#dataTable").DataTable({language:{url:"/key3/js/datatable-zh.json"},dom:"Bfrtip",ajax:{url:utils.wrapUrlWithToken("/key3/admin/api/bills/"+e),dataSrc:function(f){b(f.data.clubAssets);utils.hideLoading();return f.data.bills}},order:[1,"asc"],select:"single",responsive:true,altEditor:true,columns:[{visible:false,data:"id",type:"readonly"},{data:"createTime",render:function(f){return new Date(f).toLocaleDateString()},type:"readonly"},{data:"who",type:"readonly"},{data:"info"},{data:"cost",render:function(f){let formated=$.fn.dataTable.render.number(",",".",2,"￥").display(f);let className="text-success";if(f>=0){className="text-danger";formated="+"+formated}return'<span class="'+className+'">'+formated+"</span>"}}],buttons:[{text:'<i class="fas fa-plus-square pr-1"></i>添加',name:"add",className:"btn btn-success"},{extend:"selected",text:'<i class="fas fa-pen-square pr-1"></i>编辑',name:"edit",className:"btn btn-info"},{extend:"selected",text:'<i class="fas fa-trash-alt pr-1"></i>删除',name:"delete",className:"btn btn-danger"}],onAddRow:function(f,i,h,g){utils.showLoading("ADDING...");i.clubId=GLOBAL_VAL.nowClubId;utils.ajax("admin/api/bills",i,"POST",function(j){b(j.data.clubAssets);h(j.data)},d(g),utils.hideLoading)},onDeleteRow:function(f,i,h,g){utils.ajax("admin/api/bills/"+i.id,{},"DELETE",function(j){utils.showLoading("DELETING...");b(j.data.clubAssets);h(j.data)},d(g),utils.hideLoading)},onEditRow:function(f,i,h,g){utils.showLoading("MODIFYING...");i.clubId=GLOBAL_VAL.nowClubId;utils.ajax("admin/api/bills",i,"PUT",function(j){b(j.data.clubAssets);h(j.data)},d(g),utils.hideLoading)}})}else{if(e){datatable.ajax.url(utils.wrapUrlWithToken("/key3/admin/api/bills/"+e)).load()}else{datatable.ajax.reload()}}};utils.subscribeEvent(CONST_VAL.clubChangedEventKey,function(e){utils.showLoading();c(e.id)})});