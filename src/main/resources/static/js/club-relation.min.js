$(document).ready(function(){let datatable=null;const b=function(c){return function(d){c(d);console.error(d)}};const a=function(c){if(datatable===null){datatable=$("#dataTable").DataTable({language:{url:"/key3/js/datatable-zh.json"},dom:"Bfrtip",ajax:{url:utils.wrapUrlWithToken("/key3/admin/api/joining/"+c),dataSrc:function(d){utils.hideLoading();return d.data}},order:[4,"desc"],select:"single",responsive:true,altEditor:true,columns:[{data:"head",render:function(d){return'<img alt="头像而已" style="width: 3rem; height: 3rem" src="'+d+'" onerror="this.src=\'https://upload.cc/i1/2020/11/30/561A98.png\'"/>'},orderable:false,searchable:false,type:"readonly"},{data:"realName"},{data:"studentNo"},{data:"position",defaultContent:"-"},{data:"total",type:"number"},{data:"point",type:"number",defaultContent:"-"},{data:"admin",defaultContent:"-",type:"checkbox",render:function(d){return d?"是":"否"}}],buttons:[{text:'<i class="fas fa-plus-square pr-1"></i>添加',name:"add",className:"btn btn-success",beforeShow:function(d){d.find("#studentNo").removeAttr("readonly")}},{extend:"selected",text:'<i class="fas fa-pen-square pr-1"></i>编辑',name:"edit",className:"btn btn-info",beforeShow:function(d){let studentNoInput=d.find("#studentNo");studentNoInput.attr("readonly","readonly");studentNoInput.tooltip({title:"抱歉，因受到限制，您无法在本页面修改学号，如有需要，请到成员基本信息维护页面进行修改。谢谢！"})}},{extend:"selected",text:'<i class="fas fa-trash-alt pr-1"></i>删除',name:"delete",className:"btn btn-danger"}],onAddRow:function(d,g,f,e){utils.showLoading("ADDING...");g.clubId=GLOBAL_VAL.nowClubId;utils.ajax("admin/api/joining",g,"POST",function(h){f(h.data)},b(e),utils.hideLoading)},onDeleteRow:function(d,g,f,e){let confirmText=prompt("注意，这会同时删除用户加入社团后产生的全部信息全部信息，包括用户的贡献点数、活动室预约时长、职务信息等，如果您仍要删除，请输入该用户的姓名以进行确认","");if(confirmText!==g.realName){alert("您取消了操作，用户数据仍然是安全的");return}utils.ajax("admin/api/joining/"+GLOBAL_VAL.nowClubId+"/"+g.studentNo,{},"DELETE",function(h){utils.showLoading("DELETING...");f(h.data)},b(e),utils.hideLoading)},onEditRow:function(d,g,f,e){utils.showLoading("MODIFYING...");g.clubId=GLOBAL_VAL.nowClubId;utils.ajax("admin/api/joining",g,"PUT",function(h){f(h.data)},b(e),utils.hideLoading)}})}else{if(c){datatable.ajax.url(utils.wrapUrlWithToken("/key3/admin/api/joining/"+c)).load()}else{datatable.ajax.reload()}}};utils.subscribeEvent(CONST_VAL.clubChangedEventKey,function(c){utils.showLoading();a(c.id)})});