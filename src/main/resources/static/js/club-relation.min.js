/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2020 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

$(document).ready(function(){let e=null;function i(e){return function(t){e(t),console.error(t)}}utils.subscribeEvent(CONST_VAL.clubChangedEventKey,function(t){utils.showLoading(),t=t.id,null===e?e=$("#dataTable").DataTable({language:{url:"/key3/js/datatable-zh.json"},dom:"Bfrtip",ajax:{url:utils.wrapUrlWithToken("/key3/admin/api/joining/"+t),dataSrc:function(t){return utils.hideLoading(),t.data}},order:[4,"desc"],select:"single",responsive:!0,altEditor:!0,columns:[{data:"head",render:function(t){return'<img alt="头像而已" style="width: 3rem; height: 3rem" src="'+t+'" onerror="this.src=\'https://cxlm.work/upload/2020/12/error-df59117371c948238cd6d68dba76449a.png\'"/>'},orderable:!1,searchable:!1,type:"readonly"},{data:"realName"},{data:"studentNo",type:"number"},{data:"position",defaultContent:"-"},{data:"total",type:"number"},{data:"point",type:"number",defaultContent:"-"},{data:"absentCounter",type:"number"},{data:"admin",defaultContent:"-",type:"checkbox",render:function(t){return t?"是":"否"}}],buttons:[{text:'<i class="fas fa-plus-square pr-1"></i>添加',name:"add",className:"btn btn-success",beforeShow:function(t){t.find("#studentNo").removeAttr("readonly")}},{extend:"selected",text:'<i class="fas fa-pen-square pr-1"></i>编辑',name:"edit",className:"btn btn-info",beforeShow:function(t){let e=t.find("#studentNo");e.attr("readonly","readonly"),e.tooltip({title:"抱歉，因受到限制，您无法在本页面修改学号，如有需要，请到成员基本信息维护页面进行修改。谢谢！"})}},{extend:"selected",text:'<i class="fas fa-trash-alt pr-1"></i>删除',name:"delete",className:"btn btn-danger"}],onAddRow:function(t,e,n,a){utils.showLoading("ADDING..."),e.clubId=GLOBAL_VAL.nowClubId,utils.ajax("admin/api/joining",e,"POST",function(t){n(t.data)},i(a),utils.hideLoading)},onDeleteRow:function(t,e,n,a){utils.prompt("删除成员？","注意，这会同时删除用户加入社团后产生的全部信息全部信息，包括用户的贡献点数、活动室预约时长、职务信息等，如果您仍要删除，请输入该用户的姓名以进行确认","text",e.realName).then(function(t){inputValue===e.realName?utils.ajax("admin/api/joining/"+GLOBAL_VAL.nowClubId+"/"+e.studentNo,{},"DELETE",function(t){n(t.data),utils.success("操作成功","已删除社团成员")},function(t){a(t),console.error(t),utils.error("ERROR",t.responseJSON.msg),hintArea.text("删除失败："+t.responseJSON.msg),hintArea.addClass("text-danger")}):utils.alert("您取消了操作")})},onEditRow:function(t,e,n,a){utils.showLoading("MODIFYING..."),e.clubId=GLOBAL_VAL.nowClubId,utils.ajax("admin/api/joining",e,"PUT",function(t){n(t.data)},i(a),utils.hideLoading)}}):t?e.ajax.url(utils.wrapUrlWithToken("/key3/admin/api/joining/"+t)).load():e.ajax.reload()})});