$(document).ready(function(){let datatable=null;const b=function(c){return function(d){c(d);console.error(d)}};const a=function(c){if(datatable===null){datatable=$("#dataTable").DataTable({language:{url:"/key3/js/datatable-zh.json"},dom:"Bfrtip",ajax:{url:utils.wrapUrlWithToken("/key3/admin/api/user/all/"+c),dataSrc:function(d){utils.hideLoading();return d.data}},order:[4,"desc"],select:"single",responsive:true,altEditor:true,columns:[{visible:false,data:"id",type:"readonly"},{data:"head",render:function(d){return'<img alt="头像而已" style="width: 3rem; height: 3rem" src="'+d+'" onerror="this.src=\'https://upload.cc/i1/2020/11/30/561A98.png\'"/>'},orderable:false,searchable:false},{data:"realName",required:true},{data:"wxName",defaultContent:"-",type:"readonly"},{data:"studentNo",type:"number",required:true},{data:"institute",defaultContent:"-"},{data:"major",defaultContent:"-"},{data:"email",defaultContent:"-"},{data:"sign"}],buttons:[{text:'<i class="fas fa-plus-square pr-1"></i>添加',name:"add",className:"btn btn-success"},{extend:"selected",text:'<i class="fas fa-pen-square pr-1"></i>编辑',name:"edit",className:"btn btn-info"},{extend:"selected",text:'<i class="fas fa-trash-alt pr-1"></i>删除',name:"delete",className:"btn btn-danger"}],onAddRow:function(d,g,f,e){utils.showLoading("ADDING...");utils.ajax("admin/api/user",g,"POST",function(h){f(h.data)},b(e),utils.hideLoading)},onDeleteRow:function(d,g,f,e){let confirmText=prompt("注意，这会同时删除用户全部信息，包括社团的参加信息、活动的参加信息、所有该用户的预约；如果您不顾一切要这样做，请输入该用户的名字以进行确认","");if(confirmText!==g.realName){alert("您取消了操作，用户数据仍然是安全的");return}utils.ajax("admin/api/user/"+g.id,{},"DELETE",function(h){utils.showLoading("DELETING...");f(h.data)},b(e),utils.hideLoading)},onEditRow:function(d,g,f,e){utils.showLoading("MODIFYING...");utils.ajax("admin/api/user",g,"PUT",function(h){f(h.data)},b(e),utils.hideLoading)}})}else{if(c){datatable.ajax.url(utils.wrapUrlWithToken("/key3/admin/api/users/"+c)).load()}else{datatable.ajax.reload()}}};utils.subscribeEvent(CONST_VAL.clubChangedEventKey,function(c){utils.showLoading();a(c.id)})});