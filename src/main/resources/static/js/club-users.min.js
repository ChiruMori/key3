/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2021 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

$(document).ready(function(){let t=null;function d(a){return function(e){a(e),console.error(e)}}utils.subscribeEvent(CONST_VAL.clubChangedEventKey,function(e){utils.showLoading(),function(e){let a=[{extend:"selected",text:'<i class="fas fa-pen-square pr-1"></i>编辑',name:"edit",className:"btn btn-info"}];GLOBAL_VAL.systemAdmin&&(a.unshift({text:'<i class="fas fa-plus-square pr-1"></i>添加',name:"add",className:"btn btn-success"}),a.push({extend:"selected",text:'<i class="fas fa-trash-alt pr-1"></i>删除',name:"delete",className:"btn btn-danger"})),null===t?t=$("#dataTable").DataTable({language:{url:"/key3/js/datatable-zh.json"},dom:"Bfrtip",ajax:{url:utils.wrapUrlWithToken("/key3/admin/api/user/all/"+e),dataSrc:function(e){return utils.hideLoading(),e.data}},order:[4,"desc"],select:"single",responsive:!0,altEditor:!0,columns:[{visible:!1,data:"id",type:"readonly"},{data:"head",render:function(e){return'<img alt="头像而已" style="width: 3rem; height: 3rem" src="'+e+'" onerror="this.src=\'https://cxlm.work/upload/2020/12/error-df59117371c948238cd6d68dba76449a.png\'"/>'},orderable:!1,searchable:!1},{data:"realName",required:!0},{data:"wxName",defaultContent:"-",type:"readonly"},{data:"studentNo",type:"number",required:!0},{data:"institute",defaultContent:"-"},{data:"major",defaultContent:"-"},{data:"email",defaultContent:"-"},{data:"sign",type:"textarea"},{data:"role",type:GLOBAL_VAL.systemAdmin?"checkbox":"readonly",render:function(e){return"SYSTEM_ADMIN"===e?"是":"否"},altEditorRender:function(e){return"SYSTEM_ADMIN"===e}}],buttons:a,onAddRow:function(e,a,t,n){utils.showLoading("ADDING...");var i=a.role;delete a.role,a.systemAdmin=i,utils.ajax("admin/api/user",a,"POST",function(e){t(e.data)},d(n),utils.hideLoading)},onDeleteRow:function(e,a,t,n){$(".altEditor-modal.modal").modal("hide"),utils.prompt("删除用户？","注意，这会同时删除用户全部信息，包括社团的参加信息、活动的参加信息、所有该用户的预约；如果您不顾一切要这样做，请输入该用户的名字以进行确认","input",a.realName).then(function(e){e===a.realName&&utils.ajax("admin/api/user/"+a.id,{},"DELETE",function(e){t(e.data),utils.success("操作成功","已删除指定的用户")},d(n))})},onEditRow:function(e,a,t,n){utils.showLoading("MODIFYING...");var i=a.role;delete a.role,a.systemAdmin=i,utils.ajax("admin/api/user",a,"PUT",function(e){t(e.data)},d(n),utils.hideLoading)}}):e?t.ajax.url(utils.wrapUrlWithToken("/key3/admin/api/user/all/"+e)).load():t.ajax.reload()}(e.id)})});