$().ready(function(){const a=function(b){utils.writeCache(CONST_VAL.tokenTime,new Date().getTime()+(Number)(b.expired_in)*1000);utils.writeCache(CONST_VAL.tokenKey,b.access_token);utils.writeCache(CONST_VAL.refreshKey,b.refresh_token);window.location.href="/key3/admin/page/dashboard?admin_token_Authorization="+b.access_token};let now=new Date().getTime();let expire=utils.readCache(CONST_VAL.tokenTime);if(expire&&now<expire){let url="/admin/api/refresh/"+utils.readCache(CONST_VAL.refreshKey)+"?"+CONST_VAL.tokenQueryName+"="+utils.readCache(CONST_VAL.tokenKey);utils.ajax(url,null,"POST",function(b){a(b.data)},function(b){console.error(b);errDiv.text("自动登录失败，请尝试手动登录")})}let loginBtn=$("#loginBtn");let errDiv=$("#errMsgDiv");let formData;loginBtn.click(function(){formData=utils.formToObj("loginForm");utils.ajax("admin/api/login",formData,"POST",function(b){a(b.data)},function(b){let resObj=b.responseJSON;errDiv.text(resObj.msg);for(let inpName in resObj.data){if(resObj.data.hasOwnProperty(inpName)){$("#"+inpName+"Hint").text(resObj.data[inpName]);delete formData[inpName]}}for(let inpName in formData){if(formData.hasOwnProperty(inpName)){$("#"+inpName+"Hint").text("")}}})})});