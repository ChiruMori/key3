/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2020 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

const COLOR_CLASS_MAP={IDLE:"col",OCCUPIED:"col ele-pale-blue",FOLLOWED:"col ele-pale-purple",MINE:"col ele-pale-green",PASSED:"col ele-pale-yellow",NOT_OPEN:"col ele-pale-yellow",DISABLED_RED:"col ele-pale-red",DISABLED_WARM:"col ele-pale-warm",DISABLED_COOL:"col ele-pale-cool",OCCUPIED_HL:"col ele-light-blue",FOLLOWED_HL:"col ele-light-purple",MINE_HL:"col ele-light-green",PASSED_HL:"col ele-light-yellow",NOT_OPEN_HL:"col ele-light-yellow",DISABLED_RED_HL:"col ele-light-red",DISABLED_WARM_HL:"col ele-light-warm",DISABLED_COOL_HL:"col ele-light-cool"};$().ready(function(){var o="/admin/api/";const e=$("#blockBtn"),l=$("#clearBtn"),t=$("#editBtn"),i=$("#roomSelectTag"),n=$("#prevBtn"),a=$("#nextBtn"),c=$("#tabBody"),r=$("#weekNumber");let s,u=null,d=0,L=new Set,p={};n.on("click",function(){d--,f()}),a.on("click",function(){d++,f()}),i.on("change",function(){var e=i.val();u="-1"===e?{id:-1}:s[e],f()});function E(e,t,n){if(0!==L.size){let l=[];L.forEach(function(e){l.push(e)});n={ids:l,week:d,colorState:t,showText:n};utils.ajax(o+e,n,"PUT",function(e){O(e.data)},function(e){utils.error("ERROR",e.responseJSON.msg)})}else utils.warning("没有数据","请至少选择一项")}e.on("click",function(){utils.select("请选择颜色","选择指定的颜色，在占用时段后，显示该颜色，点击按钮确认您的选择",[{text:"红色",value:"DISABLED_RED"},{text:"暖渐变色",value:"DISABLED_WARM"},{text:"冷渐变色",value:"DISABLED_COLD"}],"form-control").then(function(e){E("block",e,null)})}),l.on("click",function(){utils.confirm("确认清除？","您将要清除"+L.size+"个时段","提交","取消").then(function(e){e&&E("clear",null,null)})}),t.on("click",function(){utils.prompt("编辑时段","请输入要显示的文本","text","提示文本").then(function(e){E("text",null,e)})});const O=function(e){L.clear(),p={},r.text(e.week);var l=e.timeTitle,o=e.timeTable;for(let n=0,e=l.length;n<e;n++){let t=$('<div class="row"></div>');var i=$('<div class="col">'+l[n]+"</div>");t.append(i);for(let l=0;l<t.length;l++){var a=o[n][l];p[a.id]=COLOR_CLASS_MAP[a.state];let e=$('<div id="'+a.id+'" class="'+COLOR_CLASS_MAP[a.state]+'" data-state="'+a.state+'">'+a.showText+"</div>");e.on("click",function(e){var l=e.target.id;L.has(l)?(L.delete(l),e.target.className=p[l]):(L.add(l),e.target.className=COLOR_CLASS_MAP.MINE_HL)}),t.append(e)}c.append(t)}},f=function(){if(null===u||-1===u.id)return e.attr("disabled",!0),l.attr("disabled",!0),t.attr("disabled",!0),void c.html('<p class="m-3 text-muted">没有数据</p>');utils.showLoading(),e.removeAttr("disabled"),l.removeAttr("disabled"),t.removeAttr("disabled"),utils.ajax(o+"table/"+u.id+"/"+d,{},"GET",function(e){O(e.data)},function(e){utils.error("ERROR",e.responseJSON.msg)},utils.hideLoading)};utils.subscribeEvent(CONST_VAL.clubChangedEventKey,function(e){utils.showLoading(),u=null,d=0,utils.ajax(o+"room/"+e.id,{},"GET",function(e){s=e.data,null===u&&(u=s.length?s[0]:{id:-1});let t="";for(let e=0,l=s.length;e<l;e++){var n=s[e];t+='<option value="'+e+'">'+n.name+"</option>\n"}0===s.length&&(t+='<option id="lastOpt" value="-1">没有活动室</option>\n'),i.html(t),f()},function(e){console.error(e),utils.error("ERROR",e.responseJSON.msg)},utils.hideLoading)})});