/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2020 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

const COLOR_CLASS_MAP={IDLE:"col",OCCUPIED:"col ele-pale-blue",FOLLOWED:"col ele-pale-purple",MINE:"col ele-pale-green",PASSED:"col ele-pale-yellow",NOT_OPEN:"col ele-pale-yellow",DISABLED_RED:"col ele-pale-red",DISABLED_WARM:"col ele-pale-warm",DISABLED_COOL:"col ele-pale-cool",OCCUPIED_HL:"col ele-light-blue",FOLLOWED_HL:"col ele-light-purple",MINE_HL:"col ele-light-green",PASSED_HL:"col ele-light-yellow",NOT_OPEN_HL:"col ele-light-yellow",DISABLED_RED_HL:"col ele-light-red",DISABLED_WARM_HL:"col ele-light-warm",DISABLED_COOL_HL:"col ele-light-cool"};$().ready(function(){var o="admin/api/";const e=$("#blockBtn"),l=$("#clearBtn"),t=$("#editBtn"),i=$("#roomSelectTag"),n=$("#prevBtn"),a=$("#nextBtn"),r=$("#tabBody"),s=$("#weekNumber");let c,u=null,d=0,L=new Set,O={};n.on("click",function(){d--,h()}),a.on("click",function(){d++,h()}),i.on("change",function(){var e=i.val();u="-1"===e?{id:-1}:c[e],h()});function p(e,t,n){if(0!==L.size){let l=[];L.forEach(function(e){l.push(e)});n={ids:l,week:d,colorState:t,showText:n};utils.ajax(o+e,n,"PUT",function(e){E(e.data)},function(e){utils.error("ERROR",e.responseJSON.msg)})}else utils.warning("没有数据","请至少选择一项")}e.on("click",function(){utils.select("请选择颜色","选择指定的颜色，在占用时段后，显示该颜色，点击按钮确认您的选择",[{text:"红色",value:"DISABLED_RED"},{text:"暖渐变色",value:"DISABLED_WARM"},{text:"冷渐变色",value:"DISABLED_COOL"}],"form-control","取消操作").then(function(e){COLOR_CLASS_MAP[e]?p("block",e,null):utils.alert("操作已取消")})}),l.on("click",function(){utils.confirm("确认清除？","您将要清除"+L.size+"个时段","提交","取消").then(function(e){e&&p("clear",null,null)})}),t.on("click",function(){utils.prompt("编辑时段","请输入要显示的文本","text","提示文本").then(function(e){e&&p("text",null,e)})});const E=function(e){L.clear(),O={},s.text(e.week);var n=e.timeTitle,o=e.timeTable;r.html("");for(let e=0,l=n.length;e<l;e++){let t=$('<div class="row"></div>');var i=$('<div class="col">'+n[e]+"</div>");t.append(i);var a=o[e];for(let l=0;l<a.length;l++){var c=a[l];O[c.id]=COLOR_CLASS_MAP[c.state];let e=$('<div id="'+c.id+'" class="'+COLOR_CLASS_MAP[c.state]+'" data-state="'+c.state+'">'+c.showText+"</div>");e.on("click",function(e){var l=e.target.id;L.has(l)?(L.delete(l),e.target.className=O[l]):(L.add(l),e.target.className=COLOR_CLASS_MAP.MINE_HL)}),t.append(e)}r.append(t)}},h=function(){if(null===u||-1===u.id)return e.attr("disabled",!0),l.attr("disabled",!0),t.attr("disabled",!0),void r.html('<p class="m-3 text-muted">没有数据</p>');utils.showLoading(),e.removeAttr("disabled"),l.removeAttr("disabled"),t.removeAttr("disabled"),utils.ajax(o+"table/"+u.id+"/"+d,{},"GET",function(e){E(e.data)},function(e){utils.error("ERROR",e.responseJSON.msg)},utils.hideLoading)};utils.subscribeEvent(CONST_VAL.clubChangedEventKey,function(e){utils.showLoading(),u=null,d=0,utils.ajax(o+"room/"+e.id,{},"GET",function(e){c=e.data,null===u&&(u=c.length?c[0]:{id:-1});let t="";for(let e=0,l=c.length;e<l;e++){var n=c[e];t+='<option value="'+e+'">'+n.name+"</option>\n"}0===c.length&&(t+='<option id="lastOpt" value="-1">没有活动室</option>\n'),i.html(t),utils.hideLoading(),h()},function(e){console.error(e),utils.error("ERROR",e.responseJSON.msg),utils.hideLoading()})})});