/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2020 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

$(document).ready(function(){let t=null;function d(t){return function(e){t(e),console.error(e)}}utils.subscribeEvent(CONST_VAL.clubChangedEventKey,function(e){var i;utils.showLoading(),i=e.id,null===t?t=$("#dataTable").DataTable({language:{url:"/key3/js/datatable-zh.json"},dom:"Bfrtip",ajax:{url:utils.wrapUrlWithToken("/key3/admin/api/announcement/"+i),dataSrc:function(e){return utils.hideLoading(),e.data}},order:[0,"desc"],select:"single",responsive:!0,altEditor:!0,columns:[{visible:!1,data:"id",type:"readonly"},{data:"showHead",render:function(e){return'<img alt="头像而已" style="width: 3rem; height: 3rem" src="'+e+'"/>'},orderable:!1,searchable:!1,type:"readonly"},{data:"who",type:"readonly"},{data:"createTime",render:function(e){return new Date(e).toLocaleDateString()},type:"readonly",altEditorRender:function(e){return utils.whenIs(e)}},{data:"title",required:!0},{data:"content",type:"textarea",required:!0}],buttons:[{text:'<i class="fas fa-plus-square pr-1"></i>添加',name:"add",className:"btn btn-success"},{extend:"selected",text:'<i class="fas fa-pen-square pr-1"></i>编辑',name:"edit",className:"btn btn-info"},{extend:"selected",text:'<i class="fas fa-trash-alt pr-1"></i>删除',name:"delete",className:"btn btn-danger"}],onAddRow:function(e,t,n,a){GLOBAL_VAL.systemAdmin&&utils.confirm("系统公告？","这条公告是一个系统级公告吗？如果是，则所用用户都会看到；如果不是，则只有社团成员才能看到","是","不是").then(function(e){utils.showLoading("ADDING..."),t.clubId=e?-1:i,delete t.createTime,utils.ajax("admin/api/announcement",t,"POST",function(e){n(e.data)},d(a),utils.hideLoading)})},onDeleteRow:function(e,t,n,a){utils.confirm("删除公告？","公告将从公告列表中移除，但因公告产生的通知无法撤回","删除","取消").then(function(e){e&&utils.ajax("admin/api/announcement/"+t.id,{},"DELETE",function(e){n(e.data),utils.success("操作成功","已删除公告")},d(a))})},onEditRow:function(e,t,n,a){utils.showLoading("MODIFYING..."),delete t.createTime,delete t.publisherId,delete t.clubId,utils.ajax("admin/api/announcement",t,"PUT",function(e){n(e.data)},d(a),utils.hideLoading)}}):i?t.ajax.url(utils.wrapUrlWithToken("/key3/admin/api/announcement/"+i)).load():t.ajax.reload()})});