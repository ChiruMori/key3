$().ready(function(){utils.subscribeEvent(CONST_VAL.clubChangedEventKey,function(a){utils.showLoading();let url="/admin/api/club";let method;let hintArea=$("#hintText");let submitBtn=$("#submitBtn");if(utils.readCache(CONST_VAL.newClubLockKey)){utils.removeCache(CONST_VAL.newClubLockKey);hintArea.text("您当前处于新建社团模式，点击创建按钮后可新建社团，如果您想退出新建社团模式，只需刷新页面即可。");submitBtn.text("新建社团");$("#clubId").val("");method="POST";utils.hideLoading()}else{$("#clubId").val(a.id);utils.ajax("/admin/api/club/"+a.id,{},"GET",function(b){let clubDTO=b.data;document.getElementById("enableAssets").checked=clubDTO.billEnabled;$("#clubName").val(clubDTO.name);$("#absentLimit").val(clubDTO.absentLimit);$("#clubAssets").val(clubDTO.assets);$("#clubId").val(clubDTO.id);$("#removeClubBtn").remove();let removeClubBtn=$('<a class="btn btn-danger" id="removeClubBtn">删除社团</a>');removeClubBtn.click(function(){let confirmText=prompt("您将要删除该社团，以及相关的财务信息、活动室归属关系、成员归属关系、公告信息。注意，该操作不可逆，如果仍要删除，请输入该社团的名称以确认操作","");if(confirmText===a.name){utils.showLoading("DELETING...");utils.ajax("/admin/api/club/"+a.id,{},"DELETE",function(){alert("已删除");location.reload()},function(c){console.error(c);hintArea.text("删除社团失败："+c.responseJSON.msg);hintArea.addClass("text-danger")},utils.hideLoading)}});$("#submitBtn").parent().append(removeClubBtn)},function(b){console.error(b);hintArea.text("信息请求失败，错误原因："+b.responseJSON.msg);hintArea.addClass("text-danger")},utils.hideLoading);method="PUT"}submitBtn.click(function(){utils.showLoading();let fromObj=utils.formToObj("club-info-form");fromObj.billEnabled=(Boolean)(fromObj.billEnabled);utils.ajax(url,fromObj,method,function(){alert("操作成功");location.reload()},function(b){hintArea.text("操作失败，"+b.responseJSON.msg);hintArea.addClass("text-danger")},utils.hideLoading)})})});