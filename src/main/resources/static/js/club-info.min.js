/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2020 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

$().ready(function(){const n=$("#submitBtn"),s=$("#hintText");let e=!1;function t(){var e=utils.readCache(CONST_VAL.newClubLockKey);return e&&(utils.removeCache(CONST_VAL.newClubLockKey),s.text("您当前处于新建社团模式，点击创建按钮后可新建社团，如果您想退出新建社团模式，只需刷新页面即可。"),n.text("新建社团"),$("#clubId").val(""),l("POST")),e}const l=function(t){n.off("click"),n.on("click",function(){utils.showLoading();let e=utils.formToObj("club-info-form");e.billEnabled=Boolean(e.billEnabled),utils.ajax("admin/api/club",e,t,function(){utils.success("操作成功","数据上传成功，即将刷新页面").then(function(){location.reload()})},function(e){utils.error("ERROR",e.responseJSON.msg),s.text("操作失败，"+e.responseJSON.msg),s.addClass("text-danger")},utils.hideLoading)})};t()&&(e=!0),utils.subscribeEvent(CONST_VAL.clubChangedEventKey,function(n){utils.showLoading(),e||t()?e=!1:($("#clubId").val(n.id),utils.ajax("/admin/api/club/"+n.id,{},"GET",function(e){e=e.data;document.getElementById("enableAssets").checked=e.billEnabled,$("#clubName").val(e.name),$("#absentLimit").val(e.absentLimit),$("#clubAssets").val(e.assets),$("#clubId").val(e.id),$("#removeClubBtn").remove();let t=$('<a class="btn btn-danger" id="removeClubBtn">删除社团</a>');t.on("click",function(){utils.prompt("删除社团？","您将要删除该社团，以及相关的财务信息、活动室归属关系、成员归属关系、公告信息。注意，该操作不可逆，如果仍要删除，请输入该社团的名称以确认操作","text",n.name).then(function(e){e===n.name?utils.ajax("/admin/api/club/"+n.id,{},"DELETE",function(){swal("操作成功","已删除社团"+e+"，即将刷新页面","success",{button:"OK!"}).then(location.reload)},function(e){console.error(e),utils.error("ERROR",e.responseJSON.msg),s.text("删除社团失败："+e.responseJSON.msg),s.addClass("text-danger")}):utils.alert("您取消了操作")})}),$("#submitBtn").parent().append(t)},function(e){console.error(e),utils.error("ERROR",e.responseJSON.msg),s.text("信息请求失败，错误原因："+e.responseJSON.msg),s.addClass("text-danger")},utils.hideLoading),l("PUT"))})});