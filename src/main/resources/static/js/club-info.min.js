/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2020 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

"use strict";$().ready(function(){var e=$("#submitBtn"),t=$("#hintText"),n=!1,s=function(){var n=utils.readCache(CONST_VAL.newClubLockKey);return n&&(utils.removeCache(CONST_VAL.newClubLockKey),t.text("您当前处于新建社团模式，点击创建按钮后可新建社团，如果您想退出新建社团模式，只需刷新页面即可。"),e.text("新建社团"),$("#clubId").val(""),i("POST")),n},i=function(n){e.off("click"),e.on("click",function(){utils.showLoading();var e=utils.formToObj("club-info-form");e.billEnabled=Boolean(e.billEnabled),utils.ajax("admin/api/club",e,n,function(){utils.success("操作成功","数据上传成功，即将刷新页面").then(function(){location.reload()})},function(e){utils.error("ERROR",e.responseJSON.msg),t.text("操作失败，"+e.responseJSON.msg),t.addClass("text-danger")},utils.hideLoading)})};s()&&(n=!0),utils.subscribeEvent(CONST_VAL.clubChangedEventKey,function(e){utils.showLoading(),n||s()?(n=!1,utils.hideLoading()):($("#clubId").val(e.id),utils.ajax("/admin/api/club/"+e.id,{},"GET",function(n){var s=n.data;document.getElementById("enableAssets").checked=s.billEnabled,$("#clubName").val(s.name),$("#absentLimit").val(s.absentLimit),$("#clubAssets").val(s.assets),$("#clubId").val(s.id),$("#removeClubBtn").remove();var i=$('<a class="btn btn-danger" id="removeClubBtn">删除社团</a>');i.on("click",function(){utils.prompt("删除社团？","您将要删除该社团，以及相关的财务信息、活动室归属关系、成员归属关系、公告信息。注意，该操作不可逆，如果仍要删除，请输入该社团的名称以确认操作","text",e.name).then(function(n){n===e.name?utils.ajax("/admin/api/club/"+e.id,{},"DELETE",function(){swal("操作成功","已删除社团"+n+"，即将刷新页面","success",{button:"OK!"}).then(location.reload)},function(e){console.error(e),utils.error("ERROR",e.responseJSON.msg),t.text("删除社团失败："+e.responseJSON.msg),t.addClass("text-danger")}):utils.alert("您取消了操作")})}),$("#submitBtn").parent().append(i)},function(e){console.error(e),utils.error("ERROR",e.responseJSON.msg),t.text("信息请求失败，错误原因："+e.responseJSON.msg),t.addClass("text-danger")},utils.hideLoading),i("PUT"))})});